---
title: "Lemur_SpatialAnalysis"
output: html_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}

getwd()
library(remotes)
#remotes::install_github("r-spatial/mapview")
library(tidyverse)
library(sf)
library(leaflet)
library(mapview)
LemurData_Raw <- read.csv("./Data/Raw/872_data.csv")
```
```{r data wranging}
LemurData_Site <- LemurData_Raw %>%
  mutate(Transect_Site2 = Transect_Site) %>%
  separate(col= Transect_Site2, into="Site", sep ="_")

Sf_LemurData_Site <- st_as_sf(LemurData_Site,
                             coords = c('long','lat'),
                             crs = 4326)

Sf_SitesCharacteristics <- Sf_LemurData_Site %>%
  group_by(Transect_Site, Site) %>%
  summarise(meanSpeciesDensity = mean(Predicted),
            tpi = mean(tpi),
            roughness=mean(roughness),
            slope= mean(slope),
            aspect = mean(aspect),
            flowdir = mean(flowdir),
            WD = mean(WD))
```

 
```

## Maps

Maping the sites

```{r Site Characteristic map}

mapviewOptions(basemaps = c("OpenStreetMap.DE"),
               vector.palette = colorRampPalette(brewer.pal(9, "YlGnBu")),
               layers.control.pos = "topright")

Map_Transect<- mapview(Sf_SitesCharacteristics,zcol="Site", legend = TRUE, alpha=0.5, cex=8, label = "Transect_Site")
Map_Transect

```


```{r Site by average pop density}

Map_Density<- mapview(Sf_SitesCharacteristics,zcol="meanSpeciesDensity", legend = TRUE, cex="meanSpeciesDensity", label = "Transect_Site")
Map_Density

Sf_SitesCharacteristics_notMiaranony <- Sf_SitesCharacteristics %>%
filter(Site!= "Miaranony")

Map_Density2<- mapview(Sf_SitesCharacteristics_notMiaranony,zcol="meanSpeciesDensity", legend = TRUE, cex="meanSpeciesDensity", label = "Transect_Site")
Map_Density2


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
