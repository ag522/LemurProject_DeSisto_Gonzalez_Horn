---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Final Project: Patterns of Lemur Density in Ranomafana National Park, Madagascar"
subtitle: "https://github.com/ag522/LemurProject_DeSisto_Gonzalez_Horn.git"
author: "Camille DeSisto, Andrea Gonzalez, Courtney Horn"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
getwd()
# Load your packages
library(lme4)
require(lmerTest)
require(lmtest)
library(corrplot)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(agricolae)
library(sf)
library(leaflet)
library(mapview)
library(MuMIn)
library(htmltools)
library(agricolae)
library(knitr)
# Set your ggplot theme
# Load your datasets
lemur_data <- read.csv("872_data.csv", header=T, stringsAsFactors = TRUE)

```


# Rationale and Research Questions

Madagascar is one of Earth’s biodiversity hotspots that harbors high levels of animal and plant endemism. Climate, land cover, and geography determine patterns of plant community structure throughout the island which, in turn, effects mammal diversity (Brown et al. 2015; Park & Razafindratsima 2019). Lemurs, Madagascar’s most prominent group of frugivores by both biomass and species richness, play a critical role in seed dispersal and related processes and are important cultural icons (Wright et al. 2005).  However, 91% of lemurs are threatened with extinction due to anthropogenic disturbances (Schwitzer et al. 2013; Razafindratsima et al. 2013).

Lemur habitat use is dependent on plant resource availability (Overdorff 1996), which is mediated by landscape-level characteristics such as roughness and slope. In fact, food trees are stronger predictors of lemur occurrence than climate (Herrera et al. 2017). Lemurs use trait-based cues to select fruits (Valenta et al. 2013; Overdorff 1996). For example, size matching, whereby large fruits are typically dispersed by large vertebrates, is an essential phenomenon in driving plant-frugivore interactions (Lim et al. 2020).  Plant nutrient content may also be an important factor in influencing frugivory interactions in tropical forests. FOr example, Madagascar is the only region where there is a significant relationship between fruit protein and the degree of frugivory among primate communities (Donati et al. 2017). Additionally, the average percentage of fruit nitrogen content in Madagascar is lower than the minimum nitrogen requirement for primates, suggesting that the low protein availability in Malagasy fruits is particularly important in shaping lemur communities (Donati et al. 2017). 

In this project, we examine a suite of environmental factors in relation to lemur densities in Ranomafana National Park, Madagascar. We seek to identify patterns in lemur densities throughout the park and examine potential causes of these patterns. Because different lemur species have specific responses to environmental cues based on their life history traits, we hypothesize that lemur densities among different sites and species are significantly different. Additionally, we expect that both landscape-level characteristics and plant functional traits act together to drive lemur densities throughout a national park in Madagascar. Specifically, we predict that a) lemur densities are negatively related to landscape roughness and slope and b) reward regulation causes positive relationships between animal densities and fruit nutrient contents. 


\newpage

# Dataset Information
Data for this project were collected by James Herrera and Camille DeSisto, as a part of a larger project aimed at investigating plant-animal interactions in Madagascar's eastern rainforests. Field data were collected by James Herrera and his colleagues in the montane evergreen rainforest of Ranomafana National Park in southwestern Madagascar. They conducted diurnal and nocturnal lemur surveys at five sites (Ampatsoana, Maharira, Miaranony, Valohoaka, and Vohiparara) between 2011 and 2014. Diurnal lemur surveys were conducted at 31 transects among these five sites, whereas nocturnal lemur surveys were conducted at 26 of these sites due to logistical constraints. Habitat variables (slope, roughness, location, topogaphic position index, elevation, flow direction, and aspect) were collected along each transects. Additionally, vegetation data were collected from botanical surveys every 100 m along each transect. Camille DeSisto calculated lemur densities using a distance sampling and model averaging approach that jointly modeled for detection and density, using the R packages "unmarked" and "MuMln" (Fiske & Chandler 201; Barton 2020; Figure 1). Trait data were previously collected from the literature and mean trait values were calculated for each transect as part of the larger research project. Upon the start of this final project, the dataset was already clean and did not require additional wrangling to be used for our spatial visualization or linear models. However, we did use data wangling to summarise the transects by group in order to conduct the analysis of variance. In total, there are 11 plant functional trait variables and 5 habitat variables per transect, in addition to the predicted densities per lemur species (Table 1). Additionally information on the variables is available in the metedata file in the Github repository. We also created a Transect Map App to better visualize the data by species and site as well as allowing the user to select a variable and visualize it's relationship with population density for a particular species per site.


\newpage

# Exploratory Analysis 

```{r, fig.cap= "Figure 1. Heat map of lemur densities at each project transect site" }
head(lemur_data)
dim(lemur_data)
str(lemur_data)

summary(lemur_data)
length(unique(lemur_data$Transect_Site))
length(unique(lemur_data$Species))


#make a heat map to visualize the densities
lemur_data$cuts <- cut(lemur_data$Predicted, breaks=c(0,0.25,0.5,0.75, 1,2,5,10,15,20,25,130))

density_plot <- ggplot(lemur_data, aes(x = Species, y =Transect_Site))+
  geom_tile(aes(fill=cuts)) + 
  theme_classic()+
  scale_fill_viridis_d(direction=-1, option="inferno")+
  theme(axis.text.x=element_text(angle = 30, hjust=1))+
  ylab("Transect")+
  labs(fill="Individual Density")

```
```{r}
transect_variables_mean <- lemur_data %>%
  summarise(LogFruitLength = mean(logFruitLength),
            LogFruitWidth = mean(logFruitWidth),
            LogSeedLength = mean(logSeedLength),
          LogSeedWidth = mean(logSeedWidth),
            LogSugar = mean(logSugar),
            LogFat = mean(logFat),
            LogProtein = mean(logProtein),
            LogNitrogen = mean(logNitrogen),
            LogTannins = mean(logTannins),
            SLA= mean(logSLA),
            WD= mean(WD),
            Tpi= mean(tpi),
            Roughness = mean(roughness),
            Slope = mean(slope),
            Aspect = mean(aspect),
            Flowdir = mean(flowdir),
          Density = mean(Predicted)
            )

transect_variables_max <- lemur_data %>%
  summarise(LogFruitLength = max(logFruitLength),
            LogFruitWidth = max(logFruitWidth),
            LogSeedLength = max(logSeedLength),
            LogSeedWidth = max(logSeedWidth),
            LogSugar = max(logSugar),
            LogFat = max(logFat),
            LogProtein = max(logProtein),
          LogNitrogen = max(logNitrogen),
            LogTannins = max(logTannins),
            SLA= max(logSLA),
            WD= max(WD),
            Tpi=max(tpi),
            Roughness = max(roughness),
            Slope = max(slope),
            Aspect = max(aspect),
            Flowdir =max(flowdir),
           Density = max(Predicted)
            )

transect_variables_min <- lemur_data %>%
  summarise(LogFruitLength = min(logFruitLength),
            LogFruitWidth = min(logFruitWidth),
            LogSeedLength = min(logSeedLength),
            LogSeedWidth = min(logSeedWidth),
          LogSugar = min(logSugar),
            LogFat = min(logFat),
            LogProtein = min(logProtein),
            LogNitrogen = min(logNitrogen),
            LogTannins = min(logTannins),
            SLA= min(logSLA),
            WD= min(WD),
            Tpi=min(tpi),
            Roughness = min(roughness),
            Slope = min(slope),
            Aspect = min(aspect),
            Flowdir =min(flowdir),
           Density = min(Predicted)
            )

transect_variables_sd <- lemur_data %>%
  summarise(LogFruitLength = sd(logFruitLength),
          LogFruitWidth = sd(logFruitWidth),
          LogSeedLength = sd(logSeedLength),
            LogSeedWidth = sd(logSeedWidth),
          LogSugar = sd(logSugar),
            LogFat = sd(logFat),
            LogProtein = sd(logProtein),
            LogNitrogen = sd(logNitrogen),
            LogTannins = sd(logTannins),
            SLA= sd(logSLA),
            WD= sd(WD),
            Tpi=sd(tpi),
            Roughness = sd(roughness),
            Slope = sd(slope),
            Aspect = sd(aspect),
            Flowdir =sd(flowdir),
           Density = sd(Predicted)
            )

transect_variables_summary <- rbind(transect_variables_max, transect_variables_min, transect_variables_mean, transect_variables_sd)
stats <- c("Maximum", "Minimum", "Mean", "Standard Deviation")
transect_variables_summary<- cbind(stats, transect_variables_summary)
transect_variables_summary <- data.frame(t(transect_variables_summary[-1]))
colnames(transect_variables_summary) <- c("Maximum", "Minimum", "Mean", "Standard Deviation")

kable(transect_variables_summary, caption ="Summary Statistics for Transect-Level Variables")

```


\newpage

# Analysis


>>>>>>> 82a58ecfeb4a4ed275c40ab5a8bfb29d48be0242
<<<<<<< HEAD
## Question 1: Are there significant differences in lemur densities among the different sites and among the different species? If so, how can the sites and species be grouped to reflect the patterns in densities? 
=======

First, we conducted a one-way analysis of variance (ANOVA) on lemur population density by site using the "aov" function in the R general interface. Next, we completed a post-hoc Tukey HSD test to determine pairwise differences between the sites. Then, we conducted a HSD post-hoc test from the R package "agricolae" (de Mendiburu 2020) to categorize the sites into groups based on their lemur densities. After these analyses of the sites, we repeated the process between lemur species rather than sites to determine if there are significant differences in densities depending on the particular species.
 
```{r}
trait_data2 <- lemur_data %>%
  mutate(Transect_Site2 = Transect_Site)%>%
  separate(col= Transect_Site2, into="Site", sep ="_")

#write.csv(trait_data2, "C:/ENV872/LemurProject_DeSisto_Gonzalez_Horn/Data/Processed/trait_data2.csv")


density_anova <- aov(data= trait_data2, Predicted ~ Site)
summary(density_anova)

#I reject the null hypothesis and conclude that there is a significant difference in lemur densities between different sites (p = 0.009). 
TukeyHSD(density_anova)
# There is a significant difference in lemur densities between Miaranony and Ampatsoana, Miaranony and Maharira, 
#and Miaranony and Vohiparara 

anova_groups <- HSD.test(density_anova, "Site", group=TRUE)
# the predicted groups according to their lemur densities are Miaranony and Valohoaka being in group a 
# and Valohoaka, Vohiparara, Ampatsoana, and Maharira in group b 


density_aov_plot <- ggplot(data = trait_data2, aes(x = Site, y = Predicted))+
  geom_boxplot()+
  ylab("Lemur Density (N Individuals/"~(Km^2))+
  theme_classic()
#based on the plot it looks like it might be outliers that are driving the pattern we see of higher lemur densities
# in Miaranony and Valohoaka
```


```{r}
density_anova2 <- aov(data= trait_data2, Predicted ~ Species)
summary(density_anova2)

#I reject the null hypothesis and conclude that there is a significant difference in lemur densities between different species (p < 0.001).

TukeyHSD(density_anova2)

anova_groups2 <- HSD.test(density_anova2, "Species", group=TRUE)
# the lemur species fall into four groups according to their densities 
#What is interesting is that the groups do not seem to be organized by taxonomic family, body size, or whether they are nocturnal. diurnal

density_aov_plot2 <- ggplot(data = trait_data2, aes(x = reorder(Species, Predicted, FUN = median), y = Predicted))+
  geom_boxplot()+
  ylab("Lemur Density (N Individuals/"~(Km^2))+
  xlab("Species")+
  theme_classic()+
  scale_x_discrete(labels= c("V. variegata", "L. microdon", "A. laniger", "C. crossleyi", "E. rufifrons", "H. gruseus", "M. rufus", "P. edwardsi", "E. rubriventer"))+
  theme(axis.text.x = element_text(angle = 45, vjust=0.5))
  
```

>>>>>>> 82a58ecfeb4a4ed275c40ab5a8bfb29d48be0242
## Question 2: What variables are related to differences in lemur densities? 

Next,analyzed what transect-level habitat variables are significantly related to lemur densities. After an exploratory correlation plot to determine the correlations between the habitat variables, we conducted linear mixed effects models using the "lmer" function in the R package "lme4" (Bates et al. 2015). We used lemur density as the dependent variable, site-level habitat characteristics (log fruit length, log fruit width, log seed length, log seed width, log fruit nitrogen content, log tree tannin content, log fruit sugar content, log fruit sugar content, log fruit protein content, latitude, longitude, aspect, slope, and roughness) as the independent variables. We conducted these models with the transect as the random variable, the lemur species as the random variable, and both the transect and the lemur species as random variables. We used a backward stepwise approach to reduce the models and conducted model selection via comparison of their Akaike Information Criterion (AIC) values using the "lrtest" function in the R package "lmtest" (Zeileis & Horton 2002). Additionally, we identified the R-squared values of the models using the "r.squaredGLMM" function in the R package "MuMln" (Barton 2020). Next, to explore the effects of habitat varaibles for specific lemur species, we subset the data by species and conducted linear models for three lemur species (Eulemur rubriventer, Propithecus edwardsi, and Lepilemur microdon) using the function "lm" from the R general interface. We used density as the dependent variable and the aforementioned habitat variables as independent variables. We chose to focus on these three lemur species as case studies because we identified them as having distinct densities based on the ANOVA and exploratory data analysis. 



```{r}
#More analyses using linear models
traitdata_subset <- select(trait_data2, logFruitLength:logSLA, Predicted, slope, aspect, lat, long)
lemur_density_Corr <- cor(traitdata_subset)
corrplot(lemur_density_Corr, method = "ellipse")
#The correlation plot matrix indicates that there are slight positive correlations between our response variable (Predicted) and multiple explanatory variables.

Fruit_trait_plot <- ggplot(traitdata_subset, aes(x = logFruitLength, y = Predicted, color = logNitrogen)) +
  geom_point()
print(Fruit_trait_plot)
# plot to visually explore the relationship between some of fruit trait variables that stood out in the correlation plot matrix and lemur density

Fruit_trait_nutrient_plot2 <- ggplot(traitdata_subset, aes(x = logProtein, y = Predicted, color = logTannins)) +
  geom_point()
print(Fruit_trait_nutrient_plot2)
# plot to visually explore the relationship between two other fruit trait variables that stood out in the correlation plot matrix and lemur density

#Creating a linear model with random effects (transect site and species as random effects)
lemur_dens_lmer1 <- lmer(data = trait_data2, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein + (1|Species) + (1|Transect_Site))
summary(lemur_dens_lmer1)

#Checking whether the linear model conforms to the assumptions of linear models
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(lemur_dens_lmer1)
par(mfrow = c(1,1))
#There appears to be a balance of positive and negative residuals, which is a good sign. However, there appears to be a strange pattern of three seperate lines with negative slopes

qqnorm(trait_data2$Predicted); qqline(trait_data2$Predicted)
#This qqplot provides information on the normality of the response variable. The data doesn't follow a normal distribution that well, but I don't think its terrible

#Reducing the linear model using the step function
step(lemur_dens_lmer1)
#The step function found that Predicted ~ logNitrogen + lat + roughness + slope + Site + logFruitLength + logFruitWidth + (1 | Species) is the best model


step_model <- lmer(data = trait_data2, Predicted ~ logNitrogen + lat + roughness + slope + Site + logFruitLength + logFruitWidth + (1 | Species))
summary(step_model)
#The model produced by the step function indicates that logNitrogen, lat, roughness, slope, SiteMaharira, SiteMiaranony, SiteValohoaka, SiteVohiparara, logFruitLength, and logFruitWidth are significant variables

#Reducing the linear model manually
lemur_dens_lmer2 <- update(lemur_dens_lmer1,~.-logSLA)
summary(lemur_dens_lmer2)

lemur_dens_lmer3 <- update(lemur_dens_lmer2,~.-logSeedLength)
summary(lemur_dens_lmer3)

lemur_dens_lmer4 <- update(lemur_dens_lmer3,~.-aspect)
summary(lemur_dens_lmer4)

lemur_dens_lmer5 <- update(lemur_dens_lmer4,~.-logTannins)
summary(lemur_dens_lmer5)

lemur_dens_lmer6 <- update(lemur_dens_lmer5,~.-logSeedWidth)
summary(lemur_dens_lmer6)

lemur_dens_lmer7 <- update(lemur_dens_lmer6,~.-logProtein)
summary(lemur_dens_lmer7)

lemur_dens_lmer8 <- update(lemur_dens_lmer7,~.-logFat)
summary(lemur_dens_lmer8)

lemur_dens_lmer9 <- update(lemur_dens_lmer8,~.-logSugar)
summary(lemur_dens_lmer9)

lemur_dens_lmer10 <- update(lemur_dens_lmer9,~.-long)
summary(lemur_dens_lmer10)

lemur_dens_lmer11 <- update(lemur_dens_lmer10,~.-SiteMiaranony)
summary(lemur_dens_lmer11)

lrtest(lemur_dens_lmer6, lemur_dens_lmer7, lemur_dens_lmer8, lemur_dens_lmer9, lemur_dens_lmer10)
AIC(lemur_dens_lmer6, lemur_dens_lmer7, lemur_dens_lmer8, lemur_dens_lmer9, lemur_dens_lmer10)
#models 6 and 7 seem to have the lowest AICs
#I select model 8
#the significant variables of lemur_dens_8 are logNitrogen, lat, roughness, slope, SiteMaharira, SiteValohoaka, SiteVohiparara, logFruitLength, and logFruitWidth

r.squaredGLMM(lemur_dens_lmer8)
#lemur_dens_lmer8 explains 46.7% of density

#now creating a linear model using more random effects (site is now a random effect) to see if it fits the data better
#Testing linear models with site as a random variable
test <- lmer(data = trait_data2, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + logFruitLength + logFat + aspect + logFruitWidth + logProtein + (1|Species) + (1|Transect_Site) + (1|Site))
summary(test)
r.squaredGLMM(test)

step(test)

#the model below was created by the step function
step_test_model <- lmer(data = trait_data2, Predicted ~ logNitrogen + logFruitLength + logFruitWidth + (1 | Species))
summary(step_test_model)

AIC(step_model, step_test_model, lemur_dens_lmer8, lemur_dens_lmer7)
#based off of the results of the AIC, the step_test_model appears to explain the data better than the model I created manually
#the significant variables of the best linear model for the entire data set are logNitrogen, logFruitLength, and logFruitWidth
#the significant variables of the next best model (lemur_dens_lmer8) are logNitrogen, lat, roughness, slope, SiteSiteMaharira, SiteValohoaka, SiteVohiparara, logFruitLength, and logFruitWidth
#Therefore, lat, roughness, slope, and site are interesting variables

#checking the residuals of the final linear model for the entire data set (step_test_model)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(step_test_model)
par(mfrow = c(1,1))




#Exploring drivers of density for individual species
#I will explore the drivers of density for the two species with the greatest densities and the two species with the lowest densities

checking_lemur_densities <-
  trait_data2 %>% 
  group_by(Species) %>% 
  summarize(mean(Predicted))

#Avahi_laniger and Lepilemur_microdon are the species with the lowest predicted densities. Eulemur_rubriventer and Propithecus_edwardsi are the species with the highest predicted densities. 
#I will create linear models for each of these four species to analyze species specific drivers of density

AL_subset <- filter(trait_data2, Species == "Avahi_laniger")

AL_lm_1 <- lm(data = AL_subset, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein)
summary(AL_lm_1)

AL_lm_2 <- update(AL_lm_1,~.-logSugar)
summary(AL_lm_2)

AL_lm_3 <- update(AL_lm_2,~.-logTannins)
summary(AL_lm_3)

AL_lm_4 <- update(AL_lm_3,~.-aspect)
summary(AL_lm_4)

AL_lm_5 <- update(AL_lm_4,~.-logNitrogen)
summary(AL_lm_5)

AL_lm_6 <- update(AL_lm_5,~.-roughness)
summary(AL_lm_6)

AL_lm_7 <- update(AL_lm_6,~.-slope)
summary(AL_lm_7)

AL_lm_8 <- update(AL_lm_7,~.-logProtein)
summary(AL_lm_8)

AL_lm_9 <- update(AL_lm_8,~.-logFat)
summary(AL_lm_9)

AL_lm_10 <- update(AL_lm_9,~.-long)
summary(AL_lm_10)

AIC(AL_lm_2, AL_lm_3, AL_lm_4, AL_lm_5, AL_lm_6, AL_lm_7, AL_lm_8, AL_lm_9, AL_lm_10)
#AL_lm_7 has the lowest AIC, and explains 82% of the variation of Avahi laniger densities 
#AL_lm_10 has only significant variables, and explains 79% of the variation of Avahi laniger densities
#I selected model AL_lm_10
#logSeedLength, lat, logSeedWidth, logSLA, SiteMaharira, SiteMiaranony, SiteValohoaka, SiteVohiparara, logFruitLength, and logFruitWidth are significant variables

ER_subset <- filter(trait_data2, Species == "Eulemur_rubriventer")

ER_lm_1 <- lm(data = AL_subset, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein)
summary(ER_lm_1)

ER_lm_2 <- update(ER_lm_1,~.-aspect)
summary(ER_lm_2)

ER_lm_3 <- update(ER_lm_2,~.-logTannins)
summary(ER_lm_3)

ER_lm_4 <- update(ER_lm_3,~.-logSugar)
summary(ER_lm_4)

ER_lm_5 <- update(ER_lm_4,~.-logNitrogen)
summary(ER_lm_5)

ER_lm_6 <- update(ER_lm_5,~.-roughness)
summary(ER_lm_6)

ER_lm_7 <- update(ER_lm_6,~.-slope)
summary(ER_lm_7)

ER_lm_8 <- update(ER_lm_7,~.-logProtein)
summary(ER_lm_8)

ER_lm_9 <- update(ER_lm_8,~.-logFat)
summary(ER_lm_9)

ER_lm_10 <- update(ER_lm_9,~.-long)
summary(ER_lm_10)
#all variables are significant

AIC(ER_lm_1, ER_lm_2, ER_lm_3, ER_lm_4, ER_lm_5, ER_lm_6, ER_lm_7, ER_lm_8, ER_lm_9, ER_lm_10)
#7 has the lowest AIC
summary(ER_lm_7)
summary(ER_lm_8)
summary(ER_lm_9)
summary(ER_lm_10)
#I selected ER_lm_10 because it had the best combination of a low AIC value and all significant variables
#logSeedLength, lat, logseedwidth, logSLA, site, logfruitlength, logfruit width are significant variables
#this model explaisn 79% of the y variable!

#Propithecus_edwardsi has the second highest density
PE_subset <- filter(trait_data2, Species == "Propithecus_edwardsi")


PE_lmer_1 <- lmer(data = PE_subset, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein + (1|Site))
summary(PE_lmer_1)

step(PE_lmer_1)

PE_step_lm <- lm(data = PE_subset, Predicted ~ lat + logSeedWidth + logTannins + long + Site + logFruitLength + logFruitWidth)
summary(PE_step_lm)
#the model generated by the step function explains 74.5% of the variation
#the step model seems to indicate that I don't need to have site as a random variable

PE_lm_1<- lm(data = PE_subset, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein)
summary(PE_lm_1)

PE_lm_2 <- update(PE_lm_1,~.-aspect)
summary(PE_lm_2)


PE_lm_3 <- update(PE_lm_2,~.-logFat)
summary(PE_lm_3)

PE_lm_4 <- update(PE_lm_3,~.-logNitrogen)
summary(PE_lm_4)

PE_lm_5 <- update(PE_lm_4,~.-roughness)
summary(PE_lm_5)


PE_lm_6 <- update(PE_lm_5,~.-logProtein)
summary(PE_lm_6)

PE_lm_7 <- update(PE_lm_6,~.-slope)
summary(PE_lm_7)

PE_lm_8 <- update(PE_lm_7,~.-logSLA)
summary(PE_lm_8)

PE_lm_9 <- update(PE_lm_8,~.-logSugar)
summary(PE_lm_9)

PE_lm_10 <- update(PE_lm_9,~.-logSeedLength)
summary(PE_lm_10)

AIC(PE_lm_1, PE_lm_2, PE_lm_3, PE_lm_4, PE_lm_5, PE_lm_6, PE_lm_7, PE_lm_8, PE_lm_9, PE_lm_10)
#PE_lm 9 and 10 have the lowest and therefore the best AIC scores
#I decided that PE_lm_10 is the best model, because it only contains significant variables
summary(PE_lm_10)
#lat, logseedwidth, logtannins, long, siteMaharira, SiteMiaranony, SiteValohoaka, SiteVohiparara, logFruitLength, and logFruitWidth are the significant variables

#Lepilemur_microdon has the lowest average density of all of the lemurs analyzed
LM_subset <- filter(trait_data2, Species == "Lepilemur_microdon")
View(LM_subset)

LM_lm_1<- lm(data = LM_subset, Predicted ~ logSeedLength + logNitrogen + lat + logSeedWidth + logTannins + roughness + long + logSugar + logSLA + slope + Site + logFruitLength + logFat + aspect + logFruitWidth + logProtein)
summary(LM_lm_1)
#Woa, this has an adjusted r squared value of 96.5!
step(LM_lm_1)

LM_lm_2 <- update(LM_lm_1,~.-logSugar)
summary(LM_lm_2)

LM_lm_2b <- update(LM_lm_2,~.-Site)
summary(LM_lm_2b)

LM_lm_3 <- update(LM_lm_2,~.-lat)
summary(LM_lm_3)

LM_lm_4 <- update(LM_lm_3,~.-logFat)
summary(LM_lm_4)

LM_lm_5 <- update(LM_lm_4,~.-logSeedLength)
summary(LM_lm_5)

LM_lm_6 <- update(LM_lm_5,~.-logSeedWidth)
summary(LM_lm_6)

LM_lm_7 <- update(LM_lm_6,~.-roughness)
summary(LM_lm_7)

LM_lm_8 <- update(LM_lm_7,~.-logProtein)
summary(LM_lm_8)

LM_lm_9 <- update(LM_lm_8,~.-long)
summary(LM_lm_9)

LM_lm_10 <- update(LM_lm_9,~.-aspect)
summary(LM_lm_10)

LM_lm_11 <- update(LM_lm_10,~.-logTannins)
summary(LM_lm_11)

LM_lm_12 <- update(LM_lm_11,~.-logNitrogen)
summary(LM_lm_12)
#model 12 has the fewest non-significant variables

LM_lm_13 <- update(LM_lm_12,~.-Site)
summary(LM_lm_13)

AIC(LM_lm_1, LM_lm_2, LM_lm_2b, LM_lm_3, LM_lm_4, LM_lm_5, LM_lm_6, LM_lm_7, LM_lm_8, LM_lm_9, LM_lm_10, LM_lm_11, LM_lm_12, LM_lm_13 )
#models 3, 4, and 8 have the best AIC values
#I choose LM_lm_9
#significant variables are logNitrogen, logTannins (marginally significant), logSLA, slope, SiteMaharira, SiteValohoaka, logFruitLength, logFruitWidth

```

<<<<<<< HEAD
=======
#Results

There is a significant difference in lemur densities between different sites (F(4,254) = 3.469, p = 0.009). In particular, a post-hoc Tukey HSD test revealed that there are significant differences in densities between Miaranony and Ampatsoana (p = 0.0287), Miaranony and Maharira (p = 0.031) and Vohiparara and Miaranony (p = 0.386) sites. However, visual analysis of lemur densities via boxplots boxplots (figure 1) suggests that the higher lemur densities observed in  Miaranony and Valohoaka are the result of outliers. An HSD post-hoc test from the R package "agricolae" (de Mendiburu 2020) indicates that the sites can be categorized into two main groups according to their lemur densities, with Miaranony in one group, Vohiparara, Ampatsona, and Maharira in another group, and Valohoaka in both groups. There is also a significant difference in lemur densities between different species (F (8,250) = 16.79, p = <2e-16). The HSD post-hoc test indicates that lemur species can be categorized into four main groups according to their density:

Group                                                                                                     | Average population Density
------------------------------|---------------------------------------------------------------------------|-----------------------------
- *Eulemur rubriventer*,*Propithecus edwardsi*,*Microcebus rufus*                                         | 2.72 - 3.80
- *Propithecus edwardsi*,*Microcebus rufus*,*Eulemur rufifrons*                                           | 2.31 - 3.03
- *Eulemur rufifrons* ,*Hapalemur griseus*                                                                | 1.11 - 2.31
- *Hapalemur griseus*,*Varecia variegata *,*Cheirogaleus crossleyi*,*Avahi laniger *,*Lepilemur microdon* | 0.24 - 1.11

<<<<<<< HEAD

## Question 2: What variables are related to differences in lemur densities? 
=======


```{r, fig.cap="Boxplot of lemur densities at each sampling site." }
print(density_aov_plot)
```

```{r , fig.cap="Boxplot of lemur densities for each species surveyed."}
print(density_aov_plot2)
```

Our best model, which contained all significant variables and was within 4 AIC values of the model with the lowest AIC, demonstrates that fruit nitrogen content, fruit length, and fruit width were significantly related to lemur density. With every increase in one percentage of nitrogen on the log scale, 

\newpage

# Summary and Conclusions

There is a significant difference in Lemur population density between different species and between different sites. Although Miaranony and Valohoaka have greater lemur densities than the other sites, this is likely driven by outliers. Ampatsoana, Maharira, and Vohiparara all have similar lemur densities. Eulemur rubriventer, Propithecus edwardsi, and Microcebus rufus all tend to have higher densities than the other lemur species, while Varecia variegata, Lepilemur microdon, Avahi laniger, and Cheirogaleus crossleyi tend to have lower densities. 

Our analyses demonstrate that these differences are related to fruit length, nitrogen content, and fruit width. Linear models also indicated that the differences may be related to latitude, roughness, slope, and site. The linear model with the second best fit as calculated by AIC analysis indicated that those variables were also significant. These results highlight the potential importance of plant functional traits in driving patterns of lemur density across a landscape. However, differences in densities could also be reflective of life history characteristics or other variables that were not included in this study, such as human disturbance.  These results could have management implications. For example, it could be beneficial to focus tree restoration efforts on species that contain the traits that are positively related to lemur densities, such as nitrogen content (*and fruit width and fruit length, but I assume different species would like different fruit sizes). Future studies ought to integrate other variables into the analysis of this question. For example, other studies could investigate how functional traits and climatic variables interact with anthropogenic disturbance to drive patterns in lemur densities. Additionally, it would be interesting to incorporate lemur functional traits to analyze if lemur diets, body sizes, and behavioral traits are significantly related to their densities in a given area. We found that the variables that influence density differ between the lemur species. We found that fruit width and fruit length are related to the densities of each of the four species we analyzed using linear models. In addition, we found that various plant traits were related to the densities of different species. Seed length and seed width were significant for two of the species analyzed (AL and ER) and tannins were significant for two of the species (PE and LM). 
-latitude was significant for three of the species
\newpage

# References
Felipe de Mendiburu (2020). agricolae: Statistical Procedures for Agricultural Research. R package
  version 1.3-3. https://CRAN.R-project.org/package=agricolae
